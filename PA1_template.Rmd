---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r setwd, echo=FALSE}
## Set working directory
setwd("/Users/ac/Desktop/UZER/kursera/datasajensspec/repres/RepData_PeerAssessment1/")
```

```{r read, echo=TRUE}
#library(dplyr)

activity <- read.csv(unz("activity.zip", "activity.csv"), stringsAsFactors=FALSE,na.strings="Not Available",header = TRUE, fill = TRUE, sep = ",")

activity[, 1]  <- as.numeric(activity[, 1])
activity[, 2]  <- as.Date(activity[, 2])
activity[, 3]  <- as.numeric(activity[, 3])



```

## What is mean total number of steps taken per day?


First, we make a histogram:
```{r setwd, echo=TRUE}
hist(activity$steps)
```



```{r setwd, echo=TRUE}
sum_act <- aggregate.data.frame(activity[1], by = list(activity[,2]), FUN=sum, na.rm=TRUE)
colnames(sum_act) <- c("Date","Total number of steps")

barplot(sum_act$`Total number of steps`, space=0, axisnames = TRUE, ylab="Number of steps", xlab = "Following day")
```

The mean number of steps and the median are:
```{r mean steps}
meanold <- mean(sum_act$`Total number of steps`, na.rm=TRUE)

medold <- median(sum_act$`Total number of steps`,na.rm=TRUE)

```


## What is the average daily activity pattern?


A time series plot of the 5-minute interval and the average number of steps:
```{r time series}
mean_act <- aggregate.data.frame(activity[1], by = list(activity[,2]), FUN=mean, na.rm=TRUE)
colnames(mean_act) <- c("Date","Total number of steps")

plot(activity$steps, type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1)

plot(mean_act$`Total number of steps`, type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1)

mean <- mean(activity$steps, na.rm=TRUE)

```



When is the maximum?
```{r maximum steps}

maxsteps <- max(activity$steps, na.rm = TRUE)
maxsteps

activity$interval[which(activity$steps == maxsteps)]
```

Whole record:
```{r maximum steps record}
activity[which(activity$steps == maxsteps),]
```
## Imputing missing values


## Imputing missing values

The number of missing values
```{r missing numbers}
sum(is.na(activity$steps))

```

Filling the NA's
```{r NA fill}
mean_act <- aggregate.data.frame(activity[1], by = list(activity[,2]), FUN=mean, na.rm=TRUE)
colnames(sum_act) <- c("Date","Mean")

newsetstep <- rep(0,length(activity[,1]))
newset2 <- cbind(newsetstep, as.date(activity$date), activity$interval)
newset3 <- activity

for (i in 1:length(activity[,1]))
{
  if (is.na(newset3[i,1] == TRUE) )
  {
        meanstep <- mean_act$steps[which(mean_act$Group.1 == newset[i,2])]
        if (is.nan(meanstep) == FALSE) newset3[i,1] = meanstep
        else newset3[i,1] = 0
  }
  else newset3[i,1] = activity[i,1]
}
```

```{r setwd, echo=TRUE}
sum_new <- aggregate.data.frame(newset3[1], by = list(newset3[,2]), FUN=sum, na.rm=TRUE)
colnames(sum_new) <- c("Date","Total number of steps")

barplot(sum_new$`Total number of steps`, space=0, axisnames = TRUE, ylab="Number of steps", xlab = "Following day")
```

In compirison with the old one:

```{r plots}

par(mfcol=c(2,1))
barplot(sum_act$`Total number of steps`, space=0, axisnames = TRUE, ylab="Number of steps with NA", xlab = "Following day")
barplot(sum_new$`Total number of steps`, space=0, axisnames = TRUE, ylab="Number of steps without NA", xlab = "Following day")
```

The mean number of steps and the median are:
```{r mean steps}
mean(sum_new$`Total number of steps`)

median(sum_new$`Total number of steps`)

```

In comparison with the old values
```{r mean steps compare}
meanold
medold

```


## Are there differences in activity patterns between weekdays and weekends?


Creating new dataset:
```{r weekdays}
## Reframe:

days1 <- weekdays(newset3$date, abbreviate = TRUE);
days2 <- gsub("Sun|Sat", "weekend",days1)
days3 <- gsub("Mon|Tue|Wed|Thu|Fri", "weekday",days2)

week_days <- cbind(newset3$steps,  days3, newset3$interval,newset3$date)
colnames(week_days) <- c("steps","week or end","intervals","date")
week_days2 <- data.frame(week_days)



adays1 <- weekdays(mean_act$Date, abbreviate = TRUE);
adays2 <- gsub("Sun|Sat", "weekend",adays1)
adays3 <- gsub("Mon|Tue|Wed|Thu|Fri", "weekday",adays2)

aweek_days <- cbind(mean_act$`Total number of steps`,  adays3)
colnames(aweek_days) <- c("steps","week or end")
aweek_days2 <- data.frame(aweek_days)

```

Making a panel plot:
```{r ploting weekdays}

normaldays <- week_days2[which(week_days2$week.or.end=="weekday"),]
weekends <- week_days2[which(week_days2$week.or.end=="weekend"),]

par(mfrow=c(2,1)) 
plot(t(weekends[3]), t(weekends[1]), type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1)
plot(t(normaldays[3]), t(normaldays[1]), type="l", xlab="Time", ylab= "Steps", col="red" , lwd=1)
```


making an averaged plot:
```{r averaged weekdays plots}


anormaldays <- aweek_days2[which(aweek_days2$week.or.end=="weekday"),]
aweekends <- aweek_days2[which(aweek_days2$week.or.end=="weekend"),]

lpw <- c(1:length(aweekends[,1]))
lpd <- c(1:length(anormaldays[,1]))

par(mfrow=c(2,1)) 
plot( t(lpw), t(aweekends[1]), type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1)
plot( t(lpd), t(anormaldays[1]), type="l", xlab="Time", ylab= "Steps", col="red" , lwd=1)
```

