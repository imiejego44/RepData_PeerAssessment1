---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r setwd, echo=FALSE}
#library(dplyr)
#setwd("/Users/ac/Desktop/UZER/kursera/datasajensspec/repres/RepData_PeerAssessment1/")
```

```{r read, echo=TRUE}
#library(dplyr)

activity <- read.csv(unz("activity.zip", "activity.csv"), stringsAsFactors=FALSE,na.strings="Not Available",header = TRUE, fill = TRUE, sep = ",")

activity[, 1]  <- as.numeric(activity[, 1])
activity[, 2]  <- as.Date(activity[, 2])
activity[, 3]  <- as.numeric(activity[, 3])
```

## What is mean total number of steps taken per day?

```{r steps-ave, echo=TRUE}
sum_act <- aggregate.data.frame(activity[1], by = list(activity[,2]), FUN=sum, na.rm=TRUE)
colnames(sum_act) <- c("Date","Total number of steps")

barplot(sum_act$`Total number of steps`, space=0, axisnames = TRUE, ylab="Number of steps", xlab = "Following day")
```

The mean number of steps and the median for every day are:
```{r mean-steps, echo=TRUE}
mean_act <- aggregate.data.frame(activity[1], by = list(activity[,2]), FUN=mean, na.rm=TRUE)
colnames(mean_act) <- c("Date","Mean")
mean_act

median_act <- aggregate.data.frame(activity[1], by = list(activity[,2]), FUN=median, na.rm=TRUE)
colnames(median_act) <- c("Date","Median")
median_act
```

And in total:

```{r mean-tot, echo=TRUE}
mean_tot <- mean(sum_act[,2])
mean_tot

median_tot <- median(sum_act[,2])
median_tot
```

## What is the average daily activity pattern?


A time series plot of the 5-minute interval and the average number of steps:
```{r time-series, echo=TRUE}
#plot(activity$steps, type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1)

plot(mean_act$Mean, type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1)

```



When is the maximum?
```{r maximum-steps, echo=TRUE}

maxsteps <- max(activity$steps, na.rm = TRUE)
maxsteps

activity$interval[which(activity$steps == maxsteps)]
```

The whole record:
```{r maximum-steps-record, echo=TRUE}
activity[which(activity$steps == maxsteps),]
```

## Imputing missing values

The number of missing values
```{r missing-numbers, echo=TRUE}
nas <- sum(is.na(activity$steps))
nas
```

Which gives the percentage:
```{r missing-percentage, echo=TRUE}
percentage <- nas/length(activity[,1])*100
percentage
```

We have planty of NAs, so we do something with them. If there is a mean of steps for the day we have a missing value, we use that mean. If there is not, which means the whole day is full of NAs, we put 0 as the number of steps.

```{r NA-fill, echo=TRUE}

newsetstep <- rep(0,length(activity[,1]))
newset2 <- cbind(newsetstep, as.Date(activity$date), activity$interval)
newset3 <- activity

for (i in 1:length(activity[,1]))
{
  if (is.na(newset3[i,1] == TRUE) )
  {
        meanstep <- mean_act$steps[which(as.Date(mean_act$Date) == as.Date(newset3[i,2]))]
        if (is.null(meanstep) == FALSE) {newset3[i,1] = meanstep}
        else newset3[i,1] = 0
  }
  else newset3[i,1] = activity[i,1]
}
```

Let us make the new histogram
```{r new-hist, echo=TRUE}
sum_new <- aggregate.data.frame(newset3[1], by = list(newset3[,2]), FUN=sum, na.rm=TRUE)
colnames(sum_new) <- c("Date","Total number of steps")

barplot(sum_new$`Total number of steps`, space=0, axisnames = TRUE, ylab="Number of steps", xlab = "Following day")
```

Which is, in compirison with the old one:

```{r plots, echo=TRUE}

par(mfcol=c(2,1))
barplot(sum_act$`Total number of steps`, space=0, axisnames = TRUE, ylab="Steps", xlab = "Following day",main="Measures with NA")
barplot(sum_new$`Total number of steps`, space=0, axisnames = TRUE, ylab="Steps", xlab = "Following day",main="Measures withou NA")
```

The new mean number of steps and the median are:
```{r mean-steps-new, echo=TRUE}
mean_new <- aggregate.data.frame(newset3[1], by = list(newset3[,2]), FUN=mean, na.rm=TRUE)
colnames(mean_new) <- c("Date","Mean")
mean_new

median_new <- aggregate.data.frame(newset3[1], by = list(newset3[,2]), FUN=median, na.rm=TRUE)
colnames(median_new) <- c("Date","Median")
median_new
```

And in total:

```{r mean-tot-new, echo=TRUE}
mean_tot_new <- mean(sum_new[,2])
mean_tot_new

median_tot_new <- median(sum_new[,2])
median_tot_new
```

## Are there differences in activity patterns between weekdays and weekends?


Creating a new dataset:
```{r weekdays, echo=TRUE}
## Reframe:

days1 <- weekdays(as.Date(newset3$date), abbreviate = TRUE);
days2 <- gsub("Sun|Sat", "weekend",days1)
days3 <- gsub("Mon|Tue|Wed|Thu|Fri", "weekday",days2)

week_days <- cbind(newset3$steps,  days3, newset3$interval,newset3$date)
colnames(week_days) <- c("steps","week or end","intervals","date")
week_days2 <- data.frame(week_days)


adays1 <- weekdays(mean_new$Date, abbreviate = TRUE);
adays2 <- gsub("Sun|Sat", "weekend",adays1)
adays3 <- gsub("Mon|Tue|Wed|Thu|Fri", "weekday",adays2)

aweek_days <- cbind(mean_new$Mean,  adays3)
colnames(aweek_days) <- c("steps","week or end")
aweek_days2 <- data.frame(aweek_days)

```


making an averaged plot:
```{r averaged-weekdays-plots, echo=TRUE}

anormaldays <- aweek_days2[which(aweek_days2$week.or.end=="weekday"),]
aweekends <- aweek_days2[which(aweek_days2$week.or.end=="weekend"),]

lpw <- c(1:length(aweekends[,1]))
lpd <- c(1:length(anormaldays[,1]))

par(mfrow=c(2,1)) 
plot( t(lpw), t(aweekends[1]), type="l", xlab="Time", ylab= "Steps", col="green" , lwd=1,main="weekends")
plot( t(lpd), t(anormaldays[1]), type="l", xlab="Time", ylab= "Steps", col="red" , lwd=1,main="weekdays")
```

Be careful with the data interpretation: if the mean of steps is 0 there is a high probability that there are missing data there.

